/*
 * File: app/controller/CollectionController.js
 *
 * This file was generated by Sencha Architect
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Sencha Touch 2.3.x library, under independent license.
 * License of Sencha Architect does not include license for Sencha Touch 2.3.x. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */

Ext.define('Phonogram.controller.CollectionController', {
    extend: 'Ext.app.Controller',

    config: {
        refs: {
            collectionContainer: '#collectionContainer',
            collectionItems: '#collectionItems',
            detailContainer: '#detailContainer',
            viewport: '#viewport'
        },

        control: {
            "#collectionItems": {
                itemtap: 'onDataviewItemTap'
            }
        }
    },

    onDataviewItemTap: function(dataview, index, target, record, e, eOpts) {
        console.log("CollectionController: onDataviewItemtap: " + target._record.data.discogsId);

        var me = this;

        me.successCB = function(results) {
            target.setStyle("background-color:rgb(255,255,255);");
            console.log("CollectionController: results from getRecordDiscogsAndUserData: ");
            console.log(results);

            // create and set the data
            var detailContainer = Ext.create('Recccords.view.DetailContainer', {});
            detailContainer.setData(results);
            detailContainer.down("#detailBar").setTitle(results.discogsData.title);
            var viewport = me.getViewport();
            viewport.add(detailContainer);

            // this will trigger activate on DetaiLContainer ad DetailContainerController
            Ext.Viewport.setActiveItem(detailContainer);


        };
        me.failCB = function(error){
            target.setStyle("background-color:rgb(255,255,255);");
            console.log("CollectionController: getRecordDiscogsAndUserData failed error : " + error);
        };
        target.setStyle("background-color:rgb(200,200,200);");
        getRecordDiscogsAndUserData(target._record.data.discogsId,me.successCB,me.failCB);
    }

});