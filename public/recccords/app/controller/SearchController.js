/*
 * File: app/controller/SearchController.js
 *
 * This file was generated by Sencha Architect
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Sencha Touch 2.3.x library, under independent license.
 * License of Sencha Architect does not include license for Sencha Touch 2.3.x. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */

Ext.define('Recccords.controller.SearchController', {
    extend: 'Ext.app.Controller',

    config: {
        refs: {
            searchResultsContainer: '#searchResultsContainer',
            searchResultsList: '#searchResultsList',
            searchResultsItems: '#searchResultsItems',
            searchHomeButton: '#searchHomeButton',
            viewport: '#viewport'
        },

        control: {
            "searchfield#searchDiscogsField": {
                change: 'onSearchfieldChange'
            },
            "#searchResultsList": {
                selectionchange: 'onSearchListSelect',
                itemtap: 'onItemTap'
            }
        }
    },

    onSearchfieldChange: function(textfield, newValue, oldValue, eOpts) {
        console.log("onsearchfieldchange oldValue "+oldValue + " newValue " + newValue);
        var me = this;

        searchCallback = function(result) {
            console.log("searchcallback " + result);
            var searchStore = Ext.data.Store({
            model: 'Recccords.model.Release',
            data: result.results
            }) ;
            console.log('count '+searchStore.totalCount);
            me.getSearchResultsItems().setStore(searchStore);

        };
        me.searchCallback = searchCallback;
        var data = searchDiscogs(newValue,me.searchCallback);
    },

    onSearchListSelect: function(selectable, records, eOpts) {
        console.log('onSearchLIstSelect');
        saveToCollection(records[0].data);
    },

    onItemTap: function(dataview, index, target, record, e, eOpts) {
        console.log("onItemTap");
    }

});